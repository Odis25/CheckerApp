@page "/login"

@using Microsoft.AspNetCore.WebUtilities

@inject NavigationManager Navigation
@inject HttpClient HttpClient

@inject IAuthService AuthService


<div class="align-content-center">
    <div class="card px-3" style="width: 500px;">
        <EditForm Model="User" OnValidSubmit="Submit">
            <div class="form-group">
                <label>Имя пользователя</label>
                <InputText class="form-control" @bind-Value="User.UserName"></InputText>
            </div>
            <div class="form-group">
                <label>Пароль</label>
                <InputText class="form-control" @bind-Value="User.Password"></InputText>
            </div>
            <div class="form-group">
                @*<button type="submit" class="btn btn-primary">Войти</button>*@
                <button type="button" @onclick="Submit" class="btn btn-primary">Войти</button>
            </div>
        </EditForm>
    </div>
</div>



@code {

    public string ReturnUrl { get; set; }

    public UserCredentials User { get; set; } = new UserCredentials();

    protected override Task OnInitializedAsync()
    {
        var query = new Uri(Navigation.Uri).Query;

        if (QueryHelpers.ParseQuery(query).TryGetValue("returnUrl", out var value))
        {
            ReturnUrl = value;
        }

        return base.OnInitializedAsync();
    }

    private async Task Submit()
    {
        var query = new Dictionary<string, string> { { "username", User.UserName }, { "password", User.Password }, { "returnUrl", ReturnUrl } };

        var uri = Navigation.BaseUri + "loginuser";
        Navigation.NavigateTo(QueryHelpers.AddQueryString(uri, query), true);

        //var res = await HttpClient.PostJsonAsync<UserCredentials>("https://localhost:5001/api/auth", User);

        //Navigation.NavigateTo(res.ReturnUrl);
    }

    private string Encode(string param)
    {
        return System.Web.HttpUtility.UrlEncode(param);
    }
}
